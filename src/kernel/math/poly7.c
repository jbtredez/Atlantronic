#include "kernel/math/poly7.h"
#include <math.h>

void poly7_simple(struct kinematics* A, struct kinematics* B, int32_t d, int32_t* a, int32_t* b)
{
	a[0] = A->x;
	b[0] = A->y;

	a[1] = ((int64_t) d * (int64_t)A->ca) >> 30;
	b[1] = ((int64_t) d * (int64_t)A->sa) >> 30;

#if 0
	a[2] = 0.5 * ( - u[0] * u[0] * k1 * sa1);
	b[2] = 0.5 * ( u[0] * u[0] * k1 * ca1);

	a[3] = (1/6.0f) * (- (u[0] * u[0] * u[0] * dk1) * sa1);
	b[3] = (1/6.0f) * ( (u[0] * u[0] * u[0] * dk1) * ca1);

	a[4] = 35 * (x2 - x1) - (20 * u[0]) * ca1 + (5 * u[0] * u[0] * k1 + 2/3.0f * u[0] * u[0] * u[0] * dk1) * sa1
			- (15 * u[1]) * ca2 - (2.5 * u[1] * u[1] * k2 - 1 /6.0f * u[1] * u[1] * u[1] * dk2) * sa2;
	b[4] = 35 * (y2 - y1) - (20 * u[0]) * sa1 - (5 * u[0] * u[0] * k1 + 2/3.0f * u[0] * u[0] * u[0] * dk1) * ca1
			- (15 * u[1]) * sa2 + (2.5 * u[1] * u[1] * k2 - 1 /6.0f * u[1] * u[1] * u[1] * dk2) * ca2;

	a[5] = -84 * (x2 - x1) + (45 * u[0] + 10 * u[2] + u[4]) * ca1 - (10 * u[0] * u[0] * k1 + u[0] * u[0] * u[0] * dk1 + 3 * u[0] * u[2] * k1) * sa1
			+ (39 * u[1] - 7 * u[3] + 0.5 * u[5]) * ca2 + ( 7 * u[1] * u[1] * k2 - 0.5 * u[1] * u[1] * u[1] * dk2 - 1.5f * u[1] * u[3] * k2) * sa2;
	b[5] = -84 * (y2 - y1) + (45 * u[0] + 10 * u[2] + u[4]) * sa1 + (10 * u[0] * u[0] * k1 + u[0] * u[0] * u[0] * dk1 + 3 * u[0] * u[2] * k1) * ca1
			+ (39 * u[1] - 7 * u[3] + 0.5 * u[5]) * sa2 - ( 7 * u[1] * u[1] * k2 - 0.5 * u[1] * u[1] * u[1] * dk2 - 1.5f * u[1] * u[3] * k2) * ca2;

	a[6] = 70 * (x2 - x1) - (36 * u[0] + 7.5f * u[2] + 2/3.0f * u[4]) * ca1 + ( 7.5f * u[0] * u[0] * k1 + 2/3.0f * u[0] * u[0] * u[0] * dk1 + 2 * u[0] * u[2] * k1) * sa1
			- (34 * u[1] - 13/2.0f * u[3] + 0.5f * u[5]) * ca2 - (13/2.0f * u[1] * u[1] * k2 - 0.5f * u[1] * u[1] * u[1] * dk2 - 1.5f * u[1] * u[3] * k2) * sa2;
	b[6] = 70 * (y2 - y1) - (36 * u[0] + 7.5f * u[2] + 2/3.0f * u[4]) * sa1 - ( 7.5f * u[0] * u[0] * k1 + 2/3.0f * u[0] * u[0] * u[0] * dk1 + 2 * u[0] * u[2] * k1) * ca1
			- (34 * u[1] - 13/2.0f * u[3] + 0.5f * u[5]) * sa2 + (13/2.0f * u[1] * u[1] * k2 - 0.5f * u[1] * u[1] * u[1] * dk2 - 1.5f * u[1] * u[3] * k2) * ca2;

	a[7] = -20 * (x2 - x1) + (10 * u[0] + 2 * u[2] + 1/6.0f * u[4]) * ca1 - (2 * u[0] * u[0] * k1 + 1/6.0f * u[0] * u[0] * u[0] * dk1 + 0.5f * u[0] * u[3] * k1) * sa1
			+ (10 * u[1] - 2 * u[3] + 1/6.0f * u[5]) * ca2 + (2 * u[1] * u[1] * k2 - 1/6.0f * u[1] * u[1] * u[1] * dk2 - 0.5 * u[1] * u[3] * k2) * sa2;
	b[7] = -20 * (y2 - y1) + (10 * u[0] + 2 * u[2] + 1/6.0f * u[4]) * sa1 + (2 * u[0] * u[0] * k1 + 1/6.0f * u[0] * u[0] * u[0] * dk1 + 0.5f * u[0] * u[3] * k1) * ca1
			+ (10 * u[1] - 2 * u[3] + 1/6.0f * u[5]) * sa2 - (2 * u[1] * u[1] * k2 - 1/6.0f * u[1] * u[1] * u[1] * dk2 - 0.5 * u[1] * u[3] * k2) * ca2;
#endif
}

void poly7f_full(float x1, float y1, float alpha1, float v1, float w1, float x2, float y2, float alpha2, float v2, float w2, float* a, float* b, float* u)
{
	float ca1 = cos(alpha1);
	float sa1 = sin(alpha1);
	float k1 = 0;//w1 / v1;
	float dk1 = 0;

	float ca2 = cos(alpha2);
	float sa2 = sin(alpha2);
	float k2 = 0;//w2 / v2;
	float dk2 = 0;

	a[0] = x1;
	b[0] = y1;

	a[1] = u[0] * ca1;
	b[1] = u[0] * sa1;

	a[2] = 0.5 * (u[2] * ca1 - u[0] * u[0] * k1 * sa1);
	b[2] = 0.5 * (u[2] * sa1 + u[0] * u[0] * k1 * ca1);

	a[3] = (1/6.0f) * (u[4] * ca1 - (u[0] * u[0] * u[0] * dk1 + 3 * u[0] * u[2]) * sa1);
	b[3] = (1/6.0f) * (u[4] * sa1 + (u[0] * u[0] * u[0] * dk1 + 3 * u[0] * u[2]) * ca1);

	a[4] = 35 * (x2 - x1) - (20 * u[0] + 5 * u[2] + 2/3.0f * u[4]) * ca1 + (5 * u[0] * u[0] * k1 + 2/3.0f * u[0] * u[0] * u[0] * dk1 + 2 * u[0] * u[2] * k1) * sa1
			- (15 * u[1] - 2.5f * u[3] + 1/6.0f * u[5]) * ca2 - (2.5 * u[1] * u[1] * k2 - 1 /6.0f * u[1] * u[1] * u[1] * dk2 - 0.5 * u[1] * u[3] * k2) * sa2;
	b[4] = 35 * (y2 - y1) - (20 * u[0] + 5 * u[2] + 2/3.0f * u[4]) * sa1 - (5 * u[0] * u[0] * k1 + 2/3.0f * u[0] * u[0] * u[0] * dk1 + 2 * u[0] * u[2] * k1) * ca1
			- (15 * u[1] - 2.5f * u[3] + 1/6.0f * u[5]) * sa2 + (2.5 * u[1] * u[1] * k2 - 1 /6.0f * u[1] * u[1] * u[1] * dk2 - 0.5 * u[1] * u[3] * k2) * ca2;

	a[5] = -84 * (x2 - x1) + (45 * u[0] + 10 * u[2] + u[4]) * ca1 - (10 * u[0] * u[0] * k1 + u[0] * u[0] * u[0] * dk1 + 3 * u[0] * u[2] * k1) * sa1
			+ (39 * u[1] - 7 * u[3] + 0.5 * u[5]) * ca2 + ( 7 * u[1] * u[1] * k2 - 0.5 * u[1] * u[1] * u[1] * dk2 - 1.5f * u[1] * u[3] * k2) * sa2;
	b[5] = -84 * (y2 - y1) + (45 * u[0] + 10 * u[2] + u[4]) * sa1 + (10 * u[0] * u[0] * k1 + u[0] * u[0] * u[0] * dk1 + 3 * u[0] * u[2] * k1) * ca1
			+ (39 * u[1] - 7 * u[3] + 0.5 * u[5]) * sa2 - ( 7 * u[1] * u[1] * k2 - 0.5 * u[1] * u[1] * u[1] * dk2 - 1.5f * u[1] * u[3] * k2) * ca2;

	a[6] = 70 * (x2 - x1) - (36 * u[0] + 7.5f * u[2] + 2/3.0f * u[4]) * ca1 + ( 7.5f * u[0] * u[0] * k1 + 2/3.0f * u[0] * u[0] * u[0] * dk1 + 2 * u[0] * u[2] * k1) * sa1
			- (34 * u[1] - 13/2.0f * u[3] + 0.5f * u[5]) * ca2 - (13/2.0f * u[1] * u[1] * k2 - 0.5f * u[1] * u[1] * u[1] * dk2 - 1.5f * u[1] * u[3] * k2) * sa2;
	b[6] = 70 * (y2 - y1) - (36 * u[0] + 7.5f * u[2] + 2/3.0f * u[4]) * sa1 - ( 7.5f * u[0] * u[0] * k1 + 2/3.0f * u[0] * u[0] * u[0] * dk1 + 2 * u[0] * u[2] * k1) * ca1
			- (34 * u[1] - 13/2.0f * u[3] + 0.5f * u[5]) * sa2 + (13/2.0f * u[1] * u[1] * k2 - 0.5f * u[1] * u[1] * u[1] * dk2 - 1.5f * u[1] * u[3] * k2) * ca2;

	a[7] = -20 * (x2 - x1) + (10 * u[0] + 2 * u[2] + 1/6.0f * u[4]) * ca1 - (2 * u[0] * u[0] * k1 + 1/6.0f * u[0] * u[0] * u[0] * dk1 + 0.5f * u[0] * u[3] * k1) * sa1
			+ (10 * u[1] - 2 * u[3] + 1/6.0f * u[5]) * ca2 + (2 * u[1] * u[1] * k2 - 1/6.0f * u[1] * u[1] * u[1] * dk2 - 0.5 * u[1] * u[3] * k2) * sa2;
	b[7] = -20 * (y2 - y1) + (10 * u[0] + 2 * u[2] + 1/6.0f * u[4]) * sa1 + (2 * u[0] * u[0] * k1 + 1/6.0f * u[0] * u[0] * u[0] * dk1 + 0.5f * u[0] * u[3] * k1) * ca1
			+ (10 * u[1] - 2 * u[3] + 1/6.0f * u[5]) * sa2 - (2 * u[1] * u[1] * k2 - 1/6.0f * u[1] * u[1] * u[1] * dk2 - 0.5 * u[1] * u[3] * k2) * ca2;
}